---
title: Next.js ë¸”ë¡œê·¸ ì œì‘ê¸° (9)
description: ì´ë¯¸ì§€ placeholder ì ìš©í•˜ê¸°
date: 2024-03-08
thumbnail: /images/image00.webp
category:
  - TypeScript
  - Next.js
series: ë¸”ë¡œê·¸ ì œì‘ê¸°
---

## ì„œë¡ 

ì˜¤ëŠ˜ë„ ë¸”ë¡œê·¸ë¥¼ ì—¬ëŠë•Œì™€ ë‹¤ë¦„ì—†ì´ ì‚´í´ë³´ëŠ”ë°, ì´ë¯¸ì§€ê°€ ì²˜ìŒ ë¡œë”©ë  ë•Œ ì•„ì˜ˆ ë³´ì´ì§€ ì•ŠëŠ” ë¬¸ì œë¥¼ ì°¾ì•„ëƒˆìŠµë‹ˆë‹¤.
ì´ë²ˆ í¬ìŠ¤íŒ…ì€ ì œê°€ ë¸”ë¡œê·¸ì— ì ìš©í•œ ì´ë¯¸ì§€ ë¡œë”© ì‹œ í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ blurì²˜ë¦¬ í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ í¬ìŠ¤íŒ… í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤ :)

## ë³€ê²½ì 

### Plaiceholderì™€ Sharp

**Plaiceholder** ëŠ” ì´ë¦„ì—ì„œë„ ëŒ€ê°• ìœ ì¶”í•  ìˆ˜ ìˆë“¯ì´, ë§ ê·¸ëŒ€ë¡œ placeholderë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.
**Sharp** ëŠ” ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. ë‹¤ë§Œ ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©ì‹œ OSê°„ì˜ í˜¸í™˜ì„± ì´ìŠˆê°€ ìˆëŠ”ë° ì´ê±´ ë’¤ì—ì„œ ë§ˆì € ì„¤ëª…í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤

Sharpì˜ ê²½ìš° Next í”„ë¡œë•ì…˜ í˜ì´ì§€ ë§Œë“¤ë•Œë‚˜, **vercel** ì„ ì‚¬ìš©í•˜ê³ ê³„ì‹œë‹¤ë©´ ì§€ì†ì ìœ¼ë¡œ Sharpë¥¼ ì„¤ì¹˜í•˜ëŠ”ê±¸ ê¶Œì¥í•œë‹¤ê³  ì•Œë ¤ì£¼ëŠ”ë°ìš”,
ì´ëŠ” Nextì—ì„œ ì œê³µí•˜ëŠ” Next/Imageì—ì„œ **sharp**, **squoosh** ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ”ë° sharpê°€ ì˜ì¡´ì„±ì— ì—†ë‹¤ë©´ squooshë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
ë¬¼ë¡  vercelì„ í†µí•´ ë°°í¬í•œë‹¤ë©´ ìê¸°ë“¤ì´ ì•Œì•„ì„œ í•´ì¤ë‹ˆë‹¤.

í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```bash
yarn add sharp plaiceholder @plaiceholder/next
npm install sharp plaiceholder @plaiceholder/next
```

### next config ì„¸íŒ…

íŒ¨í‚¤ì§€ë¥¼ ë‹¤ ì„¤ì¹˜í•˜ì…¨ë‹¤ë©´ ìš°ì„  next.configë¥¼ ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.

```js showLineNumbers
/** @type {import('next').NextConfig} **/
import { withContentlayer } from 'next-contentlayer'
import withPlaiceholder from '@plaiceholder/next'

const nextConfig = {
  webpack(config) {
    config.module.rules.push({
      test: /\.svg$/i,
      use: ['@svgr/webpack'],
    })

    return config
  },
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'avatars.githubusercontent.com',
      },
    ],
  },
}

export default withPlaiceholder(withContentlayer(nextConfig))
```

nextConfigë¥¼ exportí•´ì¤„ ë•Œ withPlaiceholderë¥¼ ê°ì‹¸ì£¼ë©´ë©ë‹ˆë‹¤.
ë‹¨, commonJSì˜ requireë¡œëŠ” ì‘ë™í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤ (esmìœ¼ë¡œë§Œ ê°€ëŠ¥í–ˆìŠµë‹ˆë‹¤), ì €ë„ ì´ë•Œë¬¸ì— í™•ì¥ìë¥¼ mjsë¡œ ë°”ê¾¸ì–´ esmìœ¼ë¡œ next.configë¥¼ ì‚¬ìš©ì¤‘ì…ë‹ˆë‹¤.
í•´ë‹¹ ë‚´ìš©ì— ëŒ€í•´ì„œ ìì„¸íˆ ì•Œê³  ê³„ì‹œëŠ”ë¶„ì€ ëŒ“ê¸€ ë‚¨ê²¨ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤ :)

ì„¤ì •ì„ ë§ˆì³¤ë‹¤ë©´ ë‹¤ìŒ ìŠ¤í…ìœ¼ë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Next/Imageì— placeholderë¡œ blurëœ ì´ë¯¸ì§€ ì ìš©í•˜ê¸°

```tsx showLineNumbers
<Image
  src={src}
  alt={src}
  width={img.width}
  height={img.height}
  placeholder="blur"
/>
```

ê³µì‹ ë¬¸ì„œì—ì„œ ì •ì ì¸ ì´ë¯¸ì§€ëŠ” ë‹¨ìˆœí•˜ê²Œ **placeholder='blur'** ì´ê²ƒë§Œ í•´ì¤˜ë„ ëœë‹¤ê³  í•˜ëŠ”ë°, ì €ëŠ” ë­ê°€ ë¬¸ì œì¸ì§€ ê·¸ê±´ ì•ˆëìŠµë‹ˆë‹¤.
Next/Imageì—ì„œëŠ” placeholder ì˜µì…˜ì„ ìœ„í•œ **blurDataURL** ì†ì„±ë„ ë°›ëŠ”ë° ìš°ë¦¬ëŠ” ì´ ì˜µì…˜ì„ ì‚¬ìš©í•  ê²ƒ ì…ë‹ˆë‹¤.

ì´ blurDataURLëŠ” ê·¸ëƒ¥ ì´ë¯¸ì§€ srcë¥¼ ë„£ì–´ì£¼ë©´ ì•ˆë˜ê³ , **base64**ë¡œ ì²˜ë¦¬ëœ ì´ë¯¸ì§€ë¥¼ ë„£ì–´ì¤˜ì•¼í•©ë‹ˆë‹¤.
ì´ë•Œ ì—¬ê¸°ì—ì„œ ì´ë¯¸ì§€ë¥¼ base64ë¡œ ì²˜ë¦¬í•´ì£¼ê¸° ìœ„í•´ì„œ plaiceholder ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. (plaiceholderê°€ sharp ê¸°ë°˜ì´ë¼ ê°™ì´ ì„¤ì¹˜í•´ì•¼í•©ë‹ˆë‹¤.)

```tsx showLineNumbers
import fs from 'node:fs/promises'
import path from 'node:path'
import { getPlaiceholder } from 'plaiceholder'

const getBlurredData = async (imgSrc: string) => {
  const buffer = await fs.readFile(path.join('./public', imgSrc))
  const {
    metadata: { height, width },
    ...plaiceholder
  } = await getPlaiceholder(buffer, { size: 10 })

  return {
    ...plaiceholder,
    img: { imgSrc, height, width },
  }
}

export default getBlurredData
```

fsëª¨ë“ˆê³¼ pathë¥¼ ì‚¬ìš©í•´ì„œ ì´ë¯¸ì§€ì˜ pathë¥¼ buffer ë³€ìˆ˜ì— ë„£ì–´ì£¼ê³ , Next/Imageì— ê¸°ë³¸ì ìœ¼ë¡œ ë“¤ì–´ê°€ëŠ” widthì™€ heightë¥¼ ë°›ì•„ì™€ì¤¬ìŠµë‹ˆë‹¤.
ê·¸ë¦¬ê³  plaiceholder ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ **getPlaiceholder**ë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ bufferì™€ placeholderì˜ ì‚¬ì´ì¦ˆë¥¼ ë„£ì–´ì¤ë‹ˆë‹¤. ê¸°ë³¸ê°’ì€ 4ì§€ë§Œ ì €ëŠ” ì»¤ìŠ¤í…€ ê°’ì„ ë„£ì–´ì¤¬ìŠµë‹ˆë‹¤.

```tsx showLineNumbers
const getBlurredData = async (imgSrc: string) => {
  const buffer = await fs.readFile(path.join('./public', imgSrc))
  const { base64 } = await getPlaiceholder(buffer, { size: 10 })

  return base64
}
```

widthì™€ heightê°™ì€ ì†ì„±ì´ í•„ìš”í•˜ì§€ ì•Šìœ¼ì‹œë‹¤ë©´ ìœ„ì˜ ë°©ë²•ìœ¼ë¡œë„ ê°€ëŠ¥í•˜ê² ë„¤ìš”

ê·¸ë¦¬ê³  ë¡œë”©ë˜ê¸° ì „ blurëœ ì´ë¯¸ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” img íƒœê·¸ë¥¼ ì»´í¬ë„ŒíŠ¸í™”ì‹œì¼°ìŠµë‹ˆë‹¤.

```tsx showLineNumbers
import getBlurredData from '@/utils/getBlurredData'
import Image from 'next/image'

export default async function ImgWithPlacehlder({
  src,
  tailwindClassNames,
}: {
  src: string
  tailwindClassNames: string
}) {
  const { base64, img } = await getBlurredData(src)

  return (
    <Image
      className={tailwindClassNames}
      src={src}
      alt={src}
      width={img.width}
      height={img.height}
      placeholder="blur"
      blurDataURL={base64}
    />
  )
}
```

tailwindClassNamesëŠ” ì œê°€ tailwindë¥¼ ì‚¬ìš©í•´ì„œ ê·¸ëŸ°ê±°ê³ , tailwind ì•ˆì“°ì‹œëŠ”ë¶„ë“¤ì€ í•„ìš” ì—†ìŠµë‹ˆë‹¤.
ì´ë ‡ê²Œ í•´ì£¼ë©´ ë¡œë”©ì‹œ í•´ë‹¹ ì´ë¯¸ì§€ ê¸°ë°˜ì˜ blurëœ ì´ë¯¸ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” imgíƒœê·¸ë¥¼ ë§Œë“¤ì–´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì ìš©ëœ ëª¨ìŠµì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤!

![blur](</images/2024/2024_03/2024_03_08/2024_03_08_(1).webp>)

## íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

### Sharpì˜ OS ë¬¸ì œ

Sharp ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•  ë•Œ ì£¼ì˜í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ì€ Sharpê°€ **OSì˜ ë°”ì´ë„ˆë¦¬ë¥¼ ì´ìš©í•˜ê¸° ë•Œë¬¸ì— OSì— ë”°ë¼ ì„¤ì¹˜ë˜ëŠ” ëª¨ë“ˆì´ ë‹¤ë¦…ë‹ˆë‹¤.** ë‹¨ìˆœ ì„¤ì¹˜ë¡œëŠ” í•´ë‹¹ OSì˜ ëª¨ë“ˆë§Œ ë°›ì•„ì§‘ë‹ˆë‹¤.
ê·¸ë ‡ê¸°ì— AWS í˜¹ì€ Vercelì— ì˜¬ë ¤ë‹¤ ì“¸ ë•Œ í•´ë‹¹ OSì˜ ëª¨ë“ˆê³¼ ë§ì§€ ì•ŠëŠ”ë‹¤ë©´ ë¬¸ì œê°€ ìƒê¹ë‹ˆë‹¤. ê·¸ëŸ¬ë‹ˆ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë‹¤ìš´ë¡œë“œí•  ë•Œ ì‚¬ìš©í•˜ëŠ” OSë¥¼ ê³ ë ¤í•˜ì—¬ ì„¤ì¹˜í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.

```bash showLineNumbers
npm install --platform=linux sharp
```

### Sharpì™€ yarn classic

sharpëŠ” yarn classicì—ì„œ ì¼ë°˜ì ìœ¼ë¡œëŠ” ì„¤ì¹˜ê°€ ì•ˆë©ë‹ˆë‹¤. ì´ ë•ŒëŠ” yarnì˜ ë²„ì „ì„ ë¬´ì‹œí•˜ê³  ì„¤ì¹˜í•˜ëŠ” --ignore-engines í”Œë˜ê·¸ë¥¼ ê°™ì´ ì¨ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

```bash showLineNumbers
yarn add sharp --ignore-engines
```

### Could not load the "sharp" module using the linux-x64 runtime / Vercel

Vercelì—ì„œ ë¹Œë“œ ì‹œ í•´ë‹¹ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©° ë¹Œë“œì— ì‹¤íŒ¨í•˜ëŠ”ë°, issueë¥¼ í™•ì¸í•œ ê²°ê³¼ sharp ë²„ì „ ë‹¤ìš´ê·¸ë ˆì´ë“œë¥¼ í†µí•´ í•´ê²°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

- [Vercel only: 0.33.0: error Could not load the "sharp" module using the linux-x64 runtime](https://github.com/lovell/sharp/issues/3870)

```bash showLineNumbers
yarn upgrade sharp@0.32.6
```

ì´ìŠˆ í•˜ë‹¨ì„ í™•ì¸í•´ë³´ë©´ nodeì˜ ë²„ì „ì„ 18.19.0ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•´ì„œ í•´ê²°ë˜ì—ˆë‹¤ëŠ” ê²½ìš°ë„ ë³´ì´ëŠ”ë°, ì•„ë‹Œ ê²½ìš°ë„ ìˆë‹¤ê³  í•˜ë‹ˆ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ê²½ìš° ë‘ ë°©ë²• ëª¨ë‘ ì‹œë„í•´ë³´ì‹œê¸¸ ë°”ëë‹ˆë‹¤.

## ì°¸ê³ 

- [Nextì—ì„œ Sharpë¡œ ì´ë¯¸ì§€ ë¡œë“œí•˜ê¸°](https://wnsdufdl.tistory.com/526)
- [[junheedot] Next.js - next/image blur ì‚¬ìš©í•˜ê¸°](https://junheedot.tistory.com/entry/Nextjs-nextimage-blur-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0)
- [[haruisshort] Next.js 13 Image plaiceholder ë¼ì´ë¸ŒëŸ¬ë¦¬ ì ìš©ê¸°](https://haruisshort.tistory.com/302)
- [[inpa.dev] ğŸ“š Sharp ëª¨ë“ˆ ì‚¬ìš©ë²• - ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• / ì›Œí„°ë§ˆí¬ ë„£ê¸°](https://inpa.tistory.com/entry/NODE-%F0%9F%93%9A-Sharp-%EB%AA%A8%EB%93%88-%EC%82%AC%EC%9A%A9%EB%B2%95-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EB%A6%AC%EC%82%AC%EC%9D%B4%EC%A7%95-%EC%9B%8C%ED%84%B0%EB%A7%88%ED%81%AC-%EB%84%A3%EA%B8%B0)
- [Plaiceholder docs](https://plaiceholder.co/docs)
